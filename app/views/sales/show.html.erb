<body onLoad="window.scroll(0, 300)">
<%if @sale.client_name != "Harry"%>
    <% title @sale.client_name %>
<%else%>
    <% title "" %>
<% end %>
<div class="hero-unit">
<%if @sale.client_name != "Harry"%>
<CENTER><H1><%= @sale.client_name %> </H1>
<%else%>
<CENTER><H1>Venta</H1>
<%end%>
<br>
<p>
    <b>Numero de Factura:</b><br>
    <%if @sale.check_number != 1111%>
        <%= @sale.check_number %>
    <%else%>
        Aun No registrado
    <%end%>
</p>

<p>
    <b>Nit del Cliente:</b><br>
    <%if @sale.nit != 1111111%>
        <%= @sale.nit%>
    <%else%>
        Aun No registrado
    <%end%>
    
</p>

<p>
    <b>Fecha de venta:</b><br>
    <%= @sale.created_at.strftime("%d/%m/%Y") %>
</p>

<p>    
    <b>Total Venta:<b><br>
    <%= @sale.price %>
</p>

<p>
    <b><Center>Detalle de Venta</Center></b>
    <div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th><Center>Nombre</Center></th>
                    <th><Center>Codigo del Producto</Center></th>
                    <th><Center>Precio</Center></th>        
                </tr>
            </thead>
            <tbody>
                <% @sale.productsales.each do |subproduct| %>
                    <tr>
                        <td><CENTER><%= subproduct.name %></CENTER></td>
                        <td><CENTER><%= subproduct.code %></CENTER></td>
                        <td><CENTER><%= subproduct.price %> Bs.</CENTER></td>
                        <% if @sale.confirmed == false %>
                        <td><%= link_to 'Eliminar de venta', {:controller => :productsales, :action => 'eliminar_subproducto_venta', :id => subproduct.id, :sale_id => @sale.id}, :class =>'btn btn-mini btn-danger'%>

                        </td>
                        <%end%>
                    </tr>
                <% end %>
            </tbody>
        </table>
    </div>
</p>

<% if @sale.confirmed == false %>
    <p>

        <h2><Center><!--%= link_to_function "Agregar Producto a venta", "$('#subproduct').toggle()" %-->Agregar Producto a Venta</Center></h2>
        <div id="subproduct" ><!--style="display:none"-->
            <br>
            <form method="GET">
                Nombre: <input type="text" name="name"> &nbsp;&nbsp;&nbsp;
                <input type="submit" value="Buscar producto", class="btn btn-info">
            </form>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th><Center>Nombre</Center></th>
                        <th><Center>Codigo del Producto</Center></th>        
                    </tr>
                </thead>
                <tbody>

                    <% @subproducts.each do |subproduct| %>
                        <tr>
                            <%if subproduct.available == true || subproduct.available == "NULL"%>
                                <td><CENTER><%= subproduct.name %></CENTER></td>
                                <td><CENTER><%= subproduct.code %></CENTER></td>
                                <td>
                                <div align="right">
                                    <button class="btn btn-jordi" data-toggle="modal" data-target="#myModal">Agregar producto a pedido</button>
                                </div>

                                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                    <h4 class="modal-title" id="myModalLabel">Agregar precio</h4>
                                                </div>
                                                <div class="modal-body">
                                                      <%= form_validated_for([@sale, @sale.productsales.build]) do |f| %>
                                                        <%= f.label :price , "Precio de venta (Bs.):" %>
                                                        <%= f.text_field :price, :maxlength => '6' %>
                                                        <%= f.hidden_field :subproduct_id, :value => subproduct.id %>
                                                        <%= f.submit "Agregar", class: "btn btn-jordi"%>
                                                </div>
                                            <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Volver</button>
                                            <!--%= f.submit "Agregar", class: "btn btn-large btn-primary" %-->
                                            <%end%>
                                        </div>
                                    </div></td>
                            <% end %>
                        </tr>
                    <% end %>
                </tbody>
            </table>
            <%= will_paginate @subproducts %>
        </div>
    </p>
    <%if @sale.price !=0 %>
        <h3><%= link_to 'Confirmar Venta', {:controller => :sales, :action => 'confirm_sale', :identificator => @sale.id}, :class => 'btn btn-large btn-jordi'%><br><br></h3>
    <%end%>
    <%= link_to 'Cancelar venta', sale_path(@sale), method: :delete, data: { confirm: 'Seguro de Cancelar la venta?' }, :class => 'btn btn-large btn-danger' %><br>
<%end%>
<br> 

<div align="left">
    <%= button_to 'Volver', sales_path, :method => :get, :class => 'btn btn-default' %><br>
</div>


  </CENTER>
  </div></body>
